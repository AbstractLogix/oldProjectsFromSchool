
//Variable Principal de la Aplicacion
//Controla todo el Sitio
var mainApp = angular.module("mainApp", [
            //Dependencias de la Aplicacion
            'ngRoute',
            'ui.grid',
            'ui.grid.edit',
            'angularSoap',
            'ngDialog',
            'ngStorage',
            'ngTouch',
            'ui.grid.selection'
                            ]);


//Factory Encargada de Los WebServicies
mainApp.factory('WebServicie', ['$soap',function($soap){
        
            //Area de Rutas de WebServicies(Luego se Cambiara por rutas Directas)
            var WarehousesWS = "http://localhost:8080/ProyectoNewAlejandria/WarehousesWSService";
            var CustomersWS = "http://localhost:8080/ProyectoNewAlejandria/CustomersWSService";
            var DocumentsWS = "http://localhost:8080/ProyectoNewAlejandria/DocumentsWSService";
            var TrakingWS = "http://localhost:8080/ProyectoNewAlejandria/TrackingWSService";
            var InvoiceWS = "http://localhost:8080/ProyectoNewAlejandria/IInvoicesWSService";
            
            return {

                //WS que Invoca WebServicie Prueba
                GetWarehouse: function(username, authenticator){
                return $soap.post(WarehousesWS,"getWarehousesOnOHRTLCFCCSByCustomer", {username: username, authenticator: authenticator});
                },
                
                //WS que Regresa WebUSer
                GetWebUser: function(username, authenticator){
                return $soap.post(CustomersWS,"getCustomer", {username: username, authenticator: authenticator});
                },
                
                //WS que regresa Wrhs*Id            
                GetDetalleWrhs: function(warehouseId,username, authenticator){
                return $soap.post(WarehousesWS,"getWarehouse", {warehouseId: warehouseId ,username: username, authenticator: authenticator});
                },
                
                //WS que regresa Documentos del Usuario          
                GetDocuments: function(username, authenticator){
                return $soap.post(DocumentsWS,"getDocumentsOnTransitByCustomer", {username: username, authenticator: authenticator});
                },
                
                //WS que regresa Traking del Documento          
                GetTrakingD: function(documentNo,username, authenticator){
                return $soap.post(TrakingWS,"getTrackingByDocument", {documentNo: documentNo ,username: username, authenticator: authenticator});
                },
                
                //WS que regresa Traking del Documento          
                GetDocumentWrhs: function(documentNo, documentType ,username, authenticator){
                return $soap.post(DocumentsWS,"getDocumentWarehouses", {documentNo: documentNo , documentType: documentType ,username: username, authenticator: authenticator});
                },
                
                 //WS que regresa Facturas del Documento          
                GetInvoiceD: function(documentNo, documentType ,username, authenticator){
                return $soap.post(InvoiceWS,"getDocumentInvoices", {documentNo: documentNo , documentType: documentType ,username: username, authenticator: authenticator});
                }
                
            };
}]);


//Se maneja el objeto Wiew en el Html para configurar las difentes Opciones del Menu
mainApp.config(['$routeProvider',
         function($routeProvider) {
            $routeProvider.
               when('/MiCarga', {
                  templateUrl: 'partials/Micarga.html',
                  controller: 'MiCargaController' //CargaController.js
               }).
               when('/MisEmbarques', {
                  templateUrl: 'partials/MisEmbarques.html',
                  controller: 'MiEmbarqueController'//EmbarquesController.js
               }).
               when('/MisFacturas', {
                  templateUrl: 'partials/MisFacturas.html',
                  controller: 'MiFacturas'
               }).
               otherwise({
                  redirectTo: '/MisFacturas'//Pagina por Default
               });
}]);
         
//ContraLador Encargado de Almacenar la Informacion Inicial del Sistema
mainApp.controller('CargarDatos', function($scope,WebServicie ,$sessionStorage){
            
            
            //Estas Variables Vienen del Login(Por motivos de prueba las tengo asi)
            //Convertimos el Password
            $sessionStorage.user = "TECNOBODEGA";
            $sessionStorage.password = "123456";
            var username = "TECNOBODEGA4";
            var password = "123456";
            var passhash = CryptoJS.MD5(username+password);
            
                
                //Encontramos el Nombre de la Empresa
                WebServicie.GetWebUser(username,passhash+'').then(function(User){
                    $scope.Nombre = User.name;
                    $sessionStorage.cliente = User.name;
                });
            
                //LLenamos el Json de los Wrhs
                //Pasamos los datos por el WebServicie
                WebServicie.GetWarehouse(username,passhash+'').then(function(WR){
                    var Wrhs = JSON.parse(WR);
                    $sessionStorage.Lwrhs = Wrhs;
                });   
                
                //LLenamos el Json de los Cocumentos
                //Pasamos los datos por el WebServicie
                WebServicie.GetDocuments(username,passhash+'').then(function(Documentos){
                    var Docu = JSON.parse(Documentos);
                    $sessionStorage.Ldocumentos = Docu;
                });   
                
            
            
});
        
         
mainApp.controller('MiFacturas', function($scope) {
            $scope.message = "Hola desde Controlador Mis Facturas";
});
         
         
       